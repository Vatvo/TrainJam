[gd_scene load_steps=36 format=3 uid="uid://12koe6sah6r1"]

[ext_resource type="Script" path="res://objects/main/game_manager.gd" id="1_mecck"]
[ext_resource type="Script" path="res://levels/main.gd" id="1_s4u06"]
[ext_resource type="Script" path="res://objects/tower_placer/tower_placer.gd" id="2_l7tu0"]
[ext_resource type="Script" path="res://objects/shop/shop.gd" id="2_u5dic"]
[ext_resource type="PackedScene" uid="uid://b2k5ei7ygajkm" path="res://objects/train/premade_trains/good_train.tscn" id="2_wpxoc"]
[ext_resource type="Texture2D" uid="uid://c6yrufk1p3hsj" path="res://icon.svg" id="3_ogqp5"]
[ext_resource type="PackedScene" uid="uid://bjbml7pwyl7a1" path="res://objects/train/premade_trains/bad_train.tscn" id="3_s4ny5"]
[ext_resource type="Script" path="res://objects/card/card.gd" id="4_qi30k"]
[ext_resource type="Texture2D" uid="uid://4hjn47x7l0jo" path="res://Images/dollar.webp" id="5_x2jtb"]
[ext_resource type="Texture2D" uid="uid://vjdrmpaoa3ny" path="res://Images/Untitled.png" id="6_kcut4"]
[ext_resource type="Texture2D" uid="uid://rl63h56uckpi" path="res://Images/pause.webp" id="7_drara"]
[ext_resource type="Texture2D" uid="uid://c6m7fbmygxp01" path="res://resources/textures/tower_icons/attacker.png" id="7_k8w2y"]
[ext_resource type="Texture2D" uid="uid://1rfcwo8ib7bq" path="res://Images/heart.webp" id="8_w1i4s"]
[ext_resource type="PackedScene" uid="uid://b51mcg6lxfngh" path="res://objects/tower/premade/attacker.tscn" id="9_7txyl"]
[ext_resource type="Texture2D" uid="uid://ctuey1d57xqoh" path="res://resources/textures/tower_icons/banker.png" id="10_147go"]
[ext_resource type="PackedScene" uid="uid://d0ewamj2o5p68" path="res://objects/tower/tower.tscn" id="10_s0ouj"]
[ext_resource type="PackedScene" uid="uid://klbobs520fyj" path="res://objects/tower/premade/banker.tscn" id="11_m026b"]
[ext_resource type="Texture2D" uid="uid://t80d82qbghyr" path="res://resources/textures/tower_icons/healer.png" id="11_xmi3y"]
[ext_resource type="PackedScene" uid="uid://c81mie7ypw2nu" path="res://objects/track_path/track_path.tscn" id="12_cd1oc"]
[ext_resource type="PackedScene" uid="uid://deydaq8vxmx7h" path="res://objects/lever/lever.tscn" id="12_sbfb4"]
[ext_resource type="PackedScene" uid="uid://cjj73ihoy0dfu" path="res://objects/track_path/branching_track_path/branching_track_path.tscn" id="13_p5ck2"]
[ext_resource type="PackedScene" uid="uid://b8pdylmyum2pi" path="res://objects/tower/premade/healer.tscn" id="13_vt1gm"]
[ext_resource type="ArrayMesh" uid="uid://b6v6sf4ao7o8e" path="res://resources/models/rails/plank_01_Cube_001.res" id="14_ucayg"]
[ext_resource type="Script" path="res://levels/lose_screen.gd" id="20_56o5v"]
[ext_resource type="Script" path="res://randomizable_timer.gd" id="25_hxs8o"]

[sub_resource type="Environment" id="Environment_epp8i"]
background_color = Color(0.699653, 0.699653, 0.699653, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_j2ysq"]
albedo_color = Color(0, 0.627451, 0, 1)

[sub_resource type="PlaneMesh" id="PlaneMesh_2cy4w"]
lightmap_size_hint = Vector2i(3840, 2160)
material = SubResource("StandardMaterial3D_j2ysq")
size = Vector2(32, 18)

[sub_resource type="BoxShape3D" id="BoxShape3D_omlow"]
size = Vector3(45.9, 0.2, 26.9)

[sub_resource type="Curve3D" id="Curve3D_omls0"]
_data = {
"points": PackedVector3Array(0, 0, 0, 0, 0, 0, -21.917, 0, -0.0170143, 0, 0, 0, 0, 0, 0, -9.01701, 0, -0.0170143),
"tilts": PackedFloat32Array(0, 0)
}
point_count = 2

[sub_resource type="MultiMesh" id="MultiMesh_rdrvv"]
transform_format = 1
instance_count = 12
mesh = ExtResource("14_ucayg")
buffer = PackedFloat32Array(0, 0, -1, -21.417, 0, 1, 0, 0, 1, 0, 0, -0.0170143, 0, 0, -1, -20.417, 0, 1, 0, 0, 1, 0, 0, -0.0170143, 0, 0, -1, -19.417, 0, 1, 0, 0, 1, 0, 0, -0.0170143, 0, 0, -1, -18.417, 0, 1, 0, 0, 1, 0, 0, -0.0170143, 0, 0, -1, -17.417, 0, 1, 0, 0, 1, 0, 0, -0.0170143, 0, 0, -1, -16.417, 0, 1, 0, 0, 1, 0, 0, -0.0170143, 0, 0, -1, -15.417, 0, 1, 0, 0, 1, 0, 0, -0.0170143, 0, 0, -1, -14.417, 0, 1, 0, 0, 1, 0, 0, -0.0170143, 0, 0, -1, -13.417, 0, 1, 0, 0, 1, 0, 0, -0.0170143, 0, 0, -1, -12.417, 0, 1, 0, 0, 1, 0, 0, -0.0170143, 0, 0, -1, -11.417, 0, 1, 0, 0, 1, 0, 0, -0.0170143, 0, 0, -1, -10.417, 0, 1, 0, 0, 1, 0, 0, -0.0170143)

[sub_resource type="Curve3D" id="Curve3D_foxa8"]
_data = {
"points": PackedVector3Array(-2.80656, 0.045495, 0.129072, 2.80656, -0.045495, -0.129072, -3.9, 0.1, -5.1, -0.969407, 0.00425339, -0.0238516, 0.969407, -0.00425339, 0.0238516, 3.73197, 0.0167599, -5.10919, -1.89274, 1.90735e-06, -1.7913, 1.89274, -1.90735e-06, 1.7913, 7.35992, 0.0164795, -2.8952, -1.12066, 0.0162954, -0.700213, 1.12066, -0.0162954, 0.700213, 11.2903, -0.036499, -0.104829),
"tilts": PackedFloat32Array(0, 0, 0, 0)
}
point_count = 4

[sub_resource type="MultiMesh" id="MultiMesh_r7v7f"]
transform_format = 1
instance_count = 16
mesh = ExtResource("14_ucayg")
buffer = PackedFloat32Array(0.0356318, 0.0150815, -0.999251, -3.40047, 0.000161438, 0.999886, 0.0150968, 0.0921916, 0.999365, -0.000699243, 0.0356253, -5.12026, 0.0201026, 0.0134086, -0.999708, -2.40096, 0.000383023, 0.99991, 0.013419, 0.0779779, 0.999798, -0.000652667, 0.0200956, -5.14768, 0.00872993, 0.0121433, -0.999888, -1.40115, 0.000528483, 0.999926, 0.0121484, 0.0652194, 0.999962, -0.000634479, 0.00872287, -5.16182, -0.000174761, 0.0111018, -0.999938, -0.401227, 0.000632062, 0.999938, 0.0111017, 0.0536079, 1, -0.000630083, -0.000181767, -5.16593, -0.00750935, 0.0101711, -0.99992, 0.598706, 0.000710119, 0.999948, 0.0101661, 0.0429778, 0.999972, -0.000633722, -0.00751618, -5.16199, -0.0138166, 0.00924578, -0.999862, 1.5986, 0.000771405, 0.999957, 0.009236, 0.0332728, 0.999904, -0.000643689, -0.0138231, -5.15124, -0.0194756, 0.00812289, -0.999777, 2.59842, 0.000820729, 0.999967, 0.00810844, 0.0245712, 0.99981, -0.00066263, -0.0194816, -5.13453, -0.0243713, 0.00551043, -0.999688, 3.59815, 0.000856013, 0.999985, 0.0054912, 0.0174393, 0.999703, -0.000721918, -0.0243756, -5.11247, -0.330207, 0.000911331, -0.943908, 4.58125, 0.00152601, 0.999999, 0.000431643, 0.0148356, 0.943907, -0.00129788, -0.330208, -4.95922, -0.559824, 0.000117255, -0.828612, 5.46426, 0.00143386, 0.999999, -0.000827234, 0.0152734, 0.828611, -0.00165122, -0.559823, -4.49613, -0.643109, 0.000405048, -0.765774, 6.25764, 0.0013531, 0.999999, -0.000607414, 0.016031, 0.765773, -0.0014268, -0.643109, -3.88816, -0.677751, 0.000761355, -0.735291, 7.00647, 0.0013334, 0.999999, -0.000193612, 0.016433, 0.73529, -0.00111166, -0.677751, -3.22552, -0.670546, 0.00237693, -0.741864, 7.73881, 0.00130886, 0.999997, 0.00202095, 0.0159659, 0.741867, 0.000384147, -0.670548, -2.54461, -0.626474, 0.00610267, -0.779419, 8.49862, 0.00104692, 0.999975, 0.0069881, 0.0115823, 0.779442, 0.00356187, -0.626465, -1.8947, -0.563821, 0.0110996, -0.825822, 9.30077, 0.000252963, 0.999912, 0.0132668, 0.00152337, 0.825897, 0.00727121, -0.563774, -1.29812, -0.501393, 0.015269, -0.865085, 10.1482, -0.00091985, 0.999834, 0.0181806, -0.0145606, 0.865219, 0.00991136, -0.501296, -0.767839)

[sub_resource type="Curve3D" id="Curve3D_kyesq"]
_data = {
"points": PackedVector3Array(0, 0, 0, 0, 0, 0, -3.8, 0, -0.1, 0, 0, 0, 0, 0, 0, 17.0488, 0, -0.1),
"tilts": PackedFloat32Array(0, 0)
}
point_count = 2

[sub_resource type="MultiMesh" id="MultiMesh_ak2ld"]
transform_format = 1
instance_count = 20
mesh = ExtResource("14_ucayg")
buffer = PackedFloat32Array(0, 0, -1, -3.3, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, -2.3, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, -1.3, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, -0.3, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 0.700001, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 1.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 2.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 3.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 4.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 5.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 6.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 7.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 8.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 9.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 10.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 11.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 12.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 13.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 14.7, 0, 1, 0, 0, 1, 0, 0, -0.1, 0, 0, -1, 15.7, 0, 1, 0, 0, 1, 0, 0, -0.1)

[node name="Main" type="Node3D"]
script = ExtResource("1_s4u06")
good_train_packed_scene = ExtResource("2_wpxoc")
bad_train_packed_scene = ExtResource("3_s4ny5")

[node name="GameManager" type="Node" parent="."]
script = ExtResource("1_mecck")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.656651, -0.645554, 0.389961, -0.493752, 0.0228814, 0.869301, -0.570104, -0.763372, -0.303719, -0.0112739, 6.67442, 7.75954)
light_indirect_energy = 0.0
light_bake_mode = 1
shadow_enabled = true
shadow_bias = 5.0
shadow_normal_bias = 1.0
shadow_blur = 4.471
directional_shadow_mode = 0
sky_mode = 1

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.485939, 0.873993, 0, -0.873993, 0.485939, 0.0112672, 28.4396, 17.6089)
projection = 1
fov = 30.1
size = 18.0
near = 0.001
far = 40.0

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_epp8i")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("PlaneMesh_2cy4w")

[node name="StaticBody3D" type="StaticBody3D" parent="MeshInstance3D"]
collision_mask = 0

[node name="CollisionShape3D" type="CollisionShape3D" parent="MeshInstance3D/StaticBody3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.95, -0.1, -1.25)
shape = SubResource("BoxShape3D_omlow")

[node name="TowerPlacer" type="Node" parent="." node_paths=PackedStringArray("valid_paths")]
script = ExtResource("2_l7tu0")
valid_paths = [NodePath("../Paths/UpperPath"), NodePath("../Paths/MainPath2")]

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="Shop" type="Node" parent="CanvasLayer"]
script = ExtResource("2_u5dic")
gold = 2000

[node name="Slot 1" type="Button" parent="CanvasLayer/Shop"]
z_index = 1
offset_left = 46.0
offset_top = 906.0
offset_right = 182.0
offset_bottom = 1042.0
icon = ExtResource("7_k8w2y")
script = ExtResource("4_qi30k")
tower = ExtResource("9_7txyl")
price = 500

[node name="Slot 2" type="Button" parent="CanvasLayer/Shop"]
z_index = 1
offset_left = 228.0
offset_top = 906.0
offset_right = 364.0
offset_bottom = 1042.0
icon = ExtResource("10_147go")
script = ExtResource("4_qi30k")
tower = ExtResource("11_m026b")
price = 800

[node name="Slot 3" type="Button" parent="CanvasLayer/Shop"]
z_index = 1
offset_left = 427.0
offset_top = 906.0
offset_right = 563.0
offset_bottom = 1042.0
icon = ExtResource("11_xmi3y")
script = ExtResource("4_qi30k")
tower = ExtResource("13_vt1gm")
price = 1100

[node name="Slot 4" type="Button" parent="CanvasLayer/Shop"]
visible = false
z_index = 1
offset_left = 618.0
offset_top = 906.0
offset_right = 754.0
offset_bottom = 1042.0
icon = ExtResource("3_ogqp5")
script = ExtResource("4_qi30k")
tower = ExtResource("10_s0ouj")
price = 1400

[node name="Slot 5" type="Button" parent="CanvasLayer/Shop"]
visible = false
z_index = 1
offset_left = 838.0
offset_top = 909.0
offset_right = 974.0
offset_bottom = 1045.0
icon = ExtResource("3_ogqp5")
script = ExtResource("4_qi30k")
tower = ExtResource("10_s0ouj")
price = 1700

[node name="Slot 6" type="Button" parent="CanvasLayer/Shop"]
visible = false
z_index = 1
offset_left = 1055.0
offset_top = 906.0
offset_right = 1191.0
offset_bottom = 1042.0
icon = ExtResource("3_ogqp5")
script = ExtResource("4_qi30k")
tower = ExtResource("10_s0ouj")
price = 2000

[node name="Slot 7" type="Button" parent="CanvasLayer/Shop"]
visible = false
z_index = 1
offset_left = 1266.0
offset_top = 909.0
offset_right = 1402.0
offset_bottom = 1045.0
icon = ExtResource("3_ogqp5")
script = ExtResource("4_qi30k")
tower = ExtResource("10_s0ouj")
price = 2300

[node name="Slot 8" type="Button" parent="CanvasLayer/Shop"]
visible = false
z_index = 1
offset_left = 1476.0
offset_top = 906.0
offset_right = 1612.0
offset_bottom = 1042.0
icon = ExtResource("3_ogqp5")
script = ExtResource("4_qi30k")
tower = ExtResource("10_s0ouj")
price = 2600

[node name="RichTextLabel" type="RichTextLabel" parent="CanvasLayer"]
z_index = 1
offset_left = 122.0
offset_top = 7.0
offset_right = 255.0
offset_bottom = 67.0
theme_override_font_sizes/normal_font_size = 42
text = "Wave:"

[node name="Dollar" type="Sprite2D" parent="CanvasLayer"]
z_index = 1
position = Vector2(1273.25, 36.25)
scale = Vector2(0.1375, 0.1375)
texture = ExtResource("5_x2jtb")

[node name="MoneyLabel" type="Label" parent="CanvasLayer/Dollar"]
offset_left = 274.545
offset_top = -241.818
offset_right = 474.545
offset_bottom = 236.182
theme_override_colors/font_color = Color(1, 1, 1, 1)
theme_override_font_sizes/font_size = 350
text = "0"

[node name="Untitled" type="Sprite2D" parent="CanvasLayer"]
position = Vector2(960, 540)
texture = ExtResource("6_kcut4")

[node name="Pause" type="Sprite2D" parent="CanvasLayer"]
visible = false
position = Vector2(41, 37)
scale = Vector2(0.0983333, 0.0983333)
texture = ExtResource("7_drara")

[node name="Heart" type="Sprite2D" parent="CanvasLayer"]
position = Vector2(1621, 33)
scale = Vector2(0.138672, 0.138672)
texture = ExtResource("8_w1i4s")

[node name="HealthLabel" type="Label" parent="CanvasLayer/Heart"]
offset_left = 274.028
offset_top = -237.972
offset_right = 474.028
offset_bottom = 240.028
theme_override_colors/font_color = Color(1, 1, 1, 1)
theme_override_font_sizes/font_size = 350
text = "0"

[node name="LoseScreen" type="Control" parent="CanvasLayer"]
process_mode = 3
visible = false
z_index = 1
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("20_56o5v")

[node name="ColorRect" type="ColorRect" parent="CanvasLayer/LoseScreen"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 0.596078)

[node name="Label" type="Label" parent="CanvasLayer/LoseScreen"]
layout_mode = 0
offset_left = 206.0
offset_top = 153.0
offset_right = 1661.0
offset_bottom = 426.0
theme_override_colors/font_color = Color(1, 1, 1, 1)
theme_override_font_sizes/font_size = 200
text = "Oh no you lost!"

[node name="Button" type="Button" parent="CanvasLayer/LoseScreen"]
layout_mode = 0
offset_left = 670.0
offset_top = 487.0
offset_right = 1229.0
offset_bottom = 632.0
theme_override_font_sizes/font_size = 100
text = "main menu"

[node name="Lever" parent="." node_paths=PackedStringArray("linked_branching_path") instance=ExtResource("12_sbfb4")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -9.3, 0, 1.5)
linked_branching_path = NodePath("../Paths/MainPath1")

[node name="Paths" type="Node3D" parent="."]

[node name="MainPath1" parent="Paths" node_paths=PackedStringArray("alternate_path", "connected_path") instance=ExtResource("13_p5ck2")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0170145, 0, 0.0170143)
curve = SubResource("Curve3D_omls0")
alternate_path = NodePath("../UpperPath")
connected_path = NodePath("../MainPath2")

[node name="MultiMeshInstance3D" parent="Paths/MainPath1" index="2"]
multimesh = SubResource("MultiMesh_rdrvv")

[node name="UpperPath" parent="Paths" node_paths=PackedStringArray("connected_path") instance=ExtResource("12_cd1oc")]
curve = SubResource("Curve3D_foxa8")
connected_path = NodePath("../MainPath2")

[node name="MultiMeshInstance3D" parent="Paths/UpperPath" index="2"]
multimesh = SubResource("MultiMesh_r7v7f")

[node name="MainPath2" parent="Paths" instance=ExtResource("12_cd1oc")]
curve = SubResource("Curve3D_kyesq")

[node name="MultiMeshInstance3D" parent="Paths/MainPath2" index="2"]
multimesh = SubResource("MultiMesh_ak2ld")

[node name="Timers" type="Node" parent="."]

[node name="GoodTrainSpawner" type="Timer" parent="Timers"]
script = ExtResource("25_hxs8o")
min = 7.0
max = 10.0

[node name="BadTrainSpanwer" type="Timer" parent="Timers"]
script = ExtResource("25_hxs8o")
min = 7.0
max = 10.0

[node name="TimeRamper" type="Timer" parent="Timers"]
script = ExtResource("25_hxs8o")
min = 30.0
max = 60.0

[connection signal="pressed" from="CanvasLayer/LoseScreen/Button" to="CanvasLayer/LoseScreen" method="_on_button_pressed"]
[connection signal="timeout" from="Timers/GoodTrainSpawner" to="." method="spawn_good_train"]
[connection signal="timeout" from="Timers/BadTrainSpanwer" to="." method="spawn_bad_train"]
[connection signal="timeout" from="Timers/TimeRamper" to="." method="decrease_timers"]

[editable path="Paths/MainPath1"]
[editable path="Paths/UpperPath"]
[editable path="Paths/MainPath2"]
